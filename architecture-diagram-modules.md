# 森屋游戏架构图 v3.0

> Unity 2D - 主角始终是食指大小，巨人世界探险

---

## 🎯 整体架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                          森屋游戏架构 v3.0                          │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                           游戏引擎层                                │
│                   Unity 2D Engine (MonoGame等)                      │
└─────────────────────────────────────────────────────────────────────┘
                                   ↓
┌─────────────────────────────────────────────────────────────────────┐
│                          游戏逻辑层                                 │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐          │
│  │  核心    │  NPC    │ 沟通    │ 烹饪    │ 经营    │ 探索    │          │
│  │ 系统    │ 系统    │ 系统    │ 系统    │ 系统    │ 系统    │          │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘          │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐          │
│  │ 魔法    │ 时间    │ 目标    │ 物品    │ 事件    │          │
│  │ 系统    │ 系统    │ 系统    │ 系统    │ 系统    │          │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘          │
└─────────────────────────────────────────────────────────────────────┘
                                   ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        世界层（两层世界）                           │
│  ┌─────────────────────────────┐      ┌─────────────────────────┐  │
│  │     人类世界（巨人世界）     │      │     精灵世界（微观世界） │  │
│  ├─────────────────────────────┤      ├─────────────────────────┤  │
│  │ • 眠山村庄                   │      │ • 精灵村庄               │  │
│  │   - 玩家的小屋（谷仓内）      │      │   - 精灵小屋             │  │
│  │   - 小镇广场                 │      │   - 精灵市场             │  │
│  │   - 商店区（巨型）            │      │   - 魔法塔               │  │
│  │   - 社区中心（巨型）          │      │   - 精灵议会             │  │
│  │                             │      │                         │  │
│  │ • 自然区域                   │      │ • 自然区域               │  │
│  │   - 巨大森林（可爬树）        │      │   - 魔法森林（发光）      │  │
│  │   - 巨大湖泊（钓鱼）          │      │   - 影子沼泽（女巫领域）  │  │
│  │   - 巨大山脉（挖矿）          │      │   - 星光沙漠（稀有）      │  │
│  │   - 巨大沙漠（隐藏宝藏）      │      │   - 流星湖（魔法鱼）      │  │
│  │   - 巨大沼泽（稀有资源）      │      │   - 时间沙漏（隐藏）      │  │
│  │                             │      │                         │  │
│  │ • 城市区域（远距离）          │      │ • 城市区域（远距离）      │  │
│  │   - 都市（初始职业地）        │      │   - 法师之城             │  │
│  │   - 高楼大厦                 │      │   - 精灵王座（最终Boss）  │  │
│  │   - 车站                     │      │                         │  │
│  │                             │      │                         │  │
│  │ • 隐藏区域                   │      │ • 隐藏区域               │  │
│  │   - 地下巨洞                 │      │   - 女巫秘密花园         │  │
│  │   - 女巫秘密花园              │      │   - 齐先生任务线         │  │
│  │   - 巨人的秘密                │      │                         │  │
│  └─────────────────────────────┘      └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
                                   ↓
┌─────────────────────────────────────────────────────────────────────┐
│                       实体层（精灵/对象）                           │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐          │
│  │ 主角    │ 巨人NPC  │ 精灵NPC  │ 物品    │ 建筑    │          │
│  │（小人儿）│（巨人）  │（小人儿）│        │        │          │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘          │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐          │
│  │ 食材    │ 工具    │ 道具    │ 菜谱    │ NPC数据  │          │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘          │
└─────────────────────────────────────────────────────────────────────┘
                                   ↓
┌─────────────────────────────────────────────────────────────────────┐
│                        数据层（持久化）                             │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐          │
│  │ 玩家数据 │ 时间数据 │ NPC数据  │ 物品数据 │ 任务数据  │          │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘          │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐          │
│  │ 关系数据 │ 统计数据 │ 存档数据 │ 云存档  │ 模组数据 │          │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘          │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 🏗️ 模块划分

### 📦 核心模块

```
┌─────────────────────────────────────────────────────────────────┐
│                        核心模块                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 玩家系统模块                                                │
│     ├── 玩家控制器（移动、跳跃、交互）                          │
│     ├── 主角视角相机系统                                        │
│     ├── 玩家状态管理（体力、金钱、属性）                        │
│     ├── 职业系统（选择、技能、背景）                            │
│     └── 变身系统（暂不使用，主角始终是小人儿）                  │
│                                                                  │
│  2. 时间系统模块                                                │
│     ├── 时间流逝控制（手动/自动）                               │
│     ├── 季节系统（春夏秋冬）                                    │
│     ├── 天气系统（晴/雨/雪）                                    │
│     ├── NPC每日日程系统                                         │
│     └── 事件触发系统                                            │
│                                                                  │
│  3. NPC系统模块                                                │
│     ├── 巨人NPC管理器                                           │
│     ├── 巨人NPC类（行为、对话、日程）                           │
│     ├── 精灵NPC管理器                                           │
│     ├── NPC关系管理系统                                         │
│     ├── NPC对话系统                                             │
│     ├── NPC礼物系统                                             │
│     ├── NPC偷听系统                                             │
│     └── NPC关键事件系统                                         │
│                                                                  │
│  4. 沟通系统模块                                              │
│     ├── 玩家与巨人互动检测                                      │
│     ├── 小人儿能力系统（爬树、钻洞、藏匿）                     │
│     ├── 礼物递送系统                                           │
│     ├── 间接对话系统（巨人视角对话）                           │
│     ├── 巨人感应系统（巨人感知玩家存在）                       │
│     └── 关系记录系统                                           │
│                                                                  │
│  5. 目标系统模块                                                │
│     ├── 任务管理器                                              │
│     ├── 社区中心收集包系统                                      │
│     ├── 个人目标系统（每日/周期/长期）                          │
│     ├── 目标检测与完成                                         │
│     ├── 奖励发放系统                                           │
│     └── 目标进度UI                                             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                        游戏玩法模块                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  6. 烹饪系统模块                                                │
│     ├── 菜谱管理系统（基础/高级/魔法菜谱）                      │
│     ├── 烹饪系统（学习、烹饪、评分）                            │
│     ├── 食材管理系统（采集、购买、种植）                        │
│     ├── 菜品效果系统（恢复、buff、特殊效果）                    │
│     ├── 厨艺等级系统                                           │
│     └── 烹饪UI界面                                             │
│                                                                  │
│  7. 开罗经营系统模块                                            │
│     ├── 商店管理系统（开店类型）                                │
│     ├── 商店控制器（管理商店）                                  │
│     ├── 顾客系统（AI、偏好、停留时间）                          │
│     ├── 库存管理系统                                           │
│     ├── 价格策略系统                                           │
│     ├── 促销活动系统                                           │
│     ├── 商店等级系统                                           │
│     ├── 顾客满意度系统                                         │
│     └── 商店UI界面                                             │
│                                                                  │
│  8. 探索系统模块                                                │
│     ├── 探索管理器                                              │
│     ├── 地图解锁系统                                           │
│     ├── 探索区域系统                                           │
│     ├── 物品收集系统                                           │
│     ├── 里程碑系统（发现、完成）                                │
│     ├── 隐藏内容系统                                           │
│     ├── 战斗系统（轻量级）                                      │
│     └── 传说收集系统                                           │
│                                                                  │
│  9. 精灵世界系统模块                                            │
│     ├── 精灵NPC管理器                                           │
│     ├── 精灵世界地图系统                                       │
│     ├── 魔法系统                                               │
│     ├── 魔法物品系统                                           │
│     ├── 魔法事件系统                                           │
│     ├── 女巫任务系统                                           │
│     ├── 齐先生任务系统                                         │
│     └── 精灵世界UI系统                                         │
│                                                                  │
│  10. 魔法系统模块                                               │
│      ├── 魔法管理器                                            │
│      ├── 魔法元素系统（火/水/自然/虚空）                       │
│      ├── 法术系统（释放、冷却、消耗）                          │
│      ├── 魔法等级系统                                         │
│      ├── 魔法物品系统                                         │
│      └── 魔法UI系统                                           │
│                                                                  │
│  11. 物品系统模块                                               │
│      ├── 物品管理系统                                           │
│      ├── 物品分类（食材/工具/道具/装备）                       │
│      ├── 物品属性系统                                          │
│      ├── 物品稀有度系统                                        │
│      ├── 物品堆叠系统                                           │
│      └── 物品UI系统                                            │
│                                                                  │
│  12. 事件系统模块                                               │
│      ├── 事件管理器                                            │
│      ├── 随机事件系统（日常/特殊/节日）                         │
│      ├── 关键事件系统                                          │
│      ├── 事件触发系统                                          │
│      ├── 事件奖励系统                                          │
│      └── 事件UI系统                                           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                        数据层模块                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  13. 数据库模块                                                 │
│      ├── 数据库连接系统                                         │
│      ├── 数据库操作（增删改查）                                 │
│      ├── 数据库事务系统                                         │
│      └── 数据库索引系统                                         │
│                                                                  │
│  14. 存档系统模块                                               │
│      ├── 存档管理器                                            │
│      ├── 存档创建/加载/保存                                     │
│      ├── 自动存档系统                                           │
│      ├── 手动存档系统                                           │
│      ├── 云存档系统（可选）                                     │
│      ├── 存档备份系统                                           │
│      └── 存档UI系统                                           │
│                                                                  │
│  15. 统计系统模块                                               │
│      ├── 统计收集系统                                           │
│      ├── 统计报告系统                                           │
│      ├── 成就系统                                               │
│      ├── 图表可视化（可选）                                     │
│      └── 统计UI系统                                           │
│                                                                  │
│  16. 音频系统模块                                               │
│      ├── 音频管理器                                            │
│      ├── 背景音乐系统                                           │
│      ├── 音效系统                                               │
│      ├── 音乐切换系统                                           │
│      ├── 音量控制系统                                           │
│      └── 音频UI系统                                           │
│                                                                  │
│  17. 视觉系统模块                                               │
│      ├── 像素渲染系统                                           │
│      ├── 特效系统（粒子、光效）                                 │
│      ├── 动画系统（角色动画、环境动画）                         │
│      ├── 场景管理器                                             │
│      ├── 场景切换系统                                           │
│      └── 视觉UI系统                                           │
│                                                                  │
│  18. 输入系统模块                                               │
│      ├── 输入管理器                                            │
│      ├── 键盘/鼠标控制                                          │
│      ├── 触摸控制（移动端支持）                                 │
│      ├── 虚拟摇杆系统（移动端）                                │
│      ├── 手势控制系统                                           │
│      └── 输入UI系统                                           │
│                                                                  │
│  19. UI系统模块                                                 │
│      ├── UI管理器                                              │
│      ├── 对话UI（巨人对话框、精灵对话框）                       │
│      ├── 菜单UI（暂停菜单、设置菜单）                           │
│      ├── 物品UI（背包、物品栏）                                 │
│      ├── 状态UI（体力、金钱、时间）                             │
│      ├── 小地图UI                                               │
│      ├── 任务UI（任务列表、目标进度）                           │
│      ├── 烹饪UI（菜谱选择、烹饪进度）                          │
│      ├── 商店UI（店铺列表、商品列表）                           │
│      ├── 探索UI（地图、里程碑）                                 │
│      └── 通知UI（浮动文字、提示框）                             │
│                                                                  │
│  20. 网络系统模块（可选）                                       │
│      ├── 网络管理器                                            │
│      ├── WebSocket连接系统                                      │
│      ├── 数据同步系统                                           │
│      ├── 角色同步系统                                           │
│      ├── 事件同步系统                                           │
│      └── 防作弊系统                                           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎮 主角小人儿能力模块

```
┌─────────────────────────────────────────────────────────────────┐
│                     主角小人儿能力模块                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 移动控制                                                     │
│     ├── WASD/方向键控制                                          │
│     ├── 虚拟摇杆控制（移动端）                                   │
│     ├── 平滑移动系统                                             │
│     ├── 边界检测系统                                             │
│     └── 移动速度调整系统                                         │
│                                                                  │
│  2. 跳跃系统                                                     │
│     ├── 地面跳跃                                                 │
│     ├── 二段跳                                                   │
│     ├── 空中跳跃                                                 │
│     ├── 跳跃高度调整                                             │
│     └── 跳跃范围检测                                             │
│                                                                  │
│  3. 爬树系统                                                     │
│     ├── 树木检测（可爬树木）                                     │
│     ├── 爬树状态管理                                             │
│     ├── 爬树速度系统                                             │
│     ├── 爬树限制（高度限制）                                     │
│     └── 爬树操作（上/下/停下）                                   │
│                                                                  │
│  4. 钻洞系统                                                     │
│     ├── 洞穴检测（可钻洞穴）                                     │
│     ├── 钻洞状态管理                                             │
│     ├── 钻洞速度系统                                             │
│     ├── 钻洞限制（大小限制）                                     │
│     └── 钻洞操作（前进/后退）                                   │
│                                                                  │
│  5. 藏匿系统                                                     │
│     ├── 藏匿位置检测（大树、箱子、角落）                         │
│     ├── 藏匿状态管理                                             │
│     ├── 藏匿检测（巨人感知系统）                                 │
│     ├── 藏匿解除（被巨人发现）                                   │
│     └── 藏匿效果（隐形、静音）                                   │
│                                                                  │
│  6. 交互系统                                                     │
│     ├── 交互范围检测                                             │
│     ├── 交互对象检测（巨人NPC、巨人物品）                       │
│     ├── 交互操作（递礼物、打招呼）                               │
│     ├── 交互限制（巨人感应范围）                                 │
│     └── 交互结果系统（成功/失败）                               │
│                                                                  │
│  7. 跳跃到巨人肩膀系统                                           │
│     ├── 巨人NPC检测（可跳到肩膀）                                 │
│     ├── 跳跃目标检测                                             │
│     ├── 跳跃操作                                                 │
│     ├── 跳跃结果系统（成功/被巨人拒绝）                         │
│     └── 跳跃后位置锁定                                           │
│                                                                  │
│  8. 偷听系统                                                     │
│     ├── 偷听范围检测                                             │
│     ├── 巨人对话监听                                             │
│     ├── 偷听内容记录                                             │
│     ├── 偷听被发现（巨人感应）                                   │
│     └── 偷听奖励（关系度提升、发现秘密）                         │
│                                                                  │
│  9. 礼物递送系统                                                 │
│     ├── 礼物选择                                                 │
│     ├── 礼物递送操作                                             │
│     ├── 巨人反应检测                                             │
│     ├── 礼物接受/拒绝系统                                       │
│     └── 关系度更新系统                                           │
│                                                                  │
│  10. 玩家视角系统                                               │
│      ├── 主角相机跟随                                             │
│      ├── 相机平滑移动                                             │
│      ├── 相机视角锁定（第一人称）                                 │
│      ├── 相机边界限制                                             │
│      └── 相机缩放系统（谷仓内/谷仓外）                           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🏠 建筑自由布置系统

```
┌─────────────────────────────────────────────────────────────────┐
│                  建筑自由布置系统模块                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 建筑管理器                                                  │
│     ├── 建筑列表管理                                             │
│     ├── 建筑加载/保存/加载                                       │
│     ├── 建筑类型系统（店铺/家居/装饰）                           │
│     └── 建筑编辑器UI                                             │
│                                                                  │
│  2. 布局编辑器系统                                              │
│     ├── 网格系统                                                 │
│     ├── 拖放系统                                                 │
│     ├── 对齐系统                                                 │
│     ├── 旋转系统                                                 │
│     ├── 缩放系统                                                 │
│     ├── 层级系统                                                 │
│     └── 撤销/重做系统                                            │
│                                                                  │
│  3. 建筑组件系统                                                │
│     ├── 家具组件                                                 │
│     ├── 装饰组件                                                 │
│     ├── 工具组件                                                 │
│     ├── 物品组件                                                 │
│     └── 建筑组件                                                 │
│                                                                  │
│  4. 建筑保存系统                                                │
│     ├── 布局数据结构                                             │
│     ├── 建筑保存/加载                                           │
│     ├── 自动保存系统                                             │
│     ├── 手动保存系统                                             │
│     ├── 布局模板系统                                             │
│     └── 布局导入/导出系统                                       │
│                                                                  │
│  5. 建筑预览系统                                                │
│     ├── 3D预览（可选）                                           │
│     ├── 2D预览                                                   │
│     ├── 预览缩放                                                 │
│     ├── 预览旋转                                                 │
│     └── 预览保存/加载                                           │
│                                                                  │
│  6. 建筑检测系统                                                │
│     ├── 空间检测（碰撞检测）                                     │
│     ├── 限制区域检测                                             │
│     ├── 楼层检测                                                 │
│     ├── 支撑检测                                                 │
│     └── 稳定性检测                                               │
│                                                                  │
│  7. 建筑互动系统                                                │
│     ├── 物品拾取/放置                                           │
│     ├── 物品使用                                                 │
│     ├── 物品交互                                                 │
│     ├── 物品存储                                                 │
│     └── 物品拾取动画                                             │
│                                                                  │
│  8. 建筑装饰系统                                                │
│     ├── 颜色选择                                                 │
│     ├── 材质选择                                                 │
│     ├── 纹理选择                                                 │
│     ├── 灯光系统                                                 │
│     └── 装饰效果系统                                             │
│                                                                  │
│  9. 建筑序列化系统                                              │
│     ├── JSON序列化                                               │
│     ├── XML序列化                                               │
│     ├── 二进制序列化                                             │
│     ├── 版本兼容系统                                             │
│     └── 数据压缩系统                                             │
│                                                                  │
│  10. 建筑同步系统（网络版本）                                   │
│      ├── 布局同步系统                                           │
│      ├── 客户端同步                                             │
│      ├── 服务器验证                                             │
│      └── 同步冲突解决                                           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📋 开发优先级建议

### Phase 1: 核心系统搭建（2-3周）
1. ✅ Unity项目初始化
2. ✅ 玩家控制与相机系统
3. ✅ 基础地图加载
4. ✅ UI系统搭建
5. ✅ 存档系统基础
6. ✅ 时间系统基础

### Phase 2: 玩法系统开发（3-4周）
1. ✅ NPC系统（巨人NPC）
2. ✅ 沟通系统（礼物、偷听）
3. ✅ 种田系统基础
4. ✅ 烹饪系统
5. ✅ 物品系统

### Phase 3: 世界系统开发（3-4周）
1. ✅ 世界地图系统
2. ✅ 建筑系统（自由布置）
3. ✅ 商店系统
4. ✅ 探索系统
5. ✅ 精灵世界系统

### Phase 4: 深度玩法（2-3周）
1. ✅ 魔法系统
2. ✅ 目标系统
3. ✅ 事件系统
4. ✅ 成就系统

### Phase 5: 优化与打磨（2-3周）
1. ✅ 性能优化
2. ✅ 音效音乐
3. ✅ 平台适配
4. ✅ Bug修复
5. ✅ 打包发布

---

## 🎯 建议的首次制作步骤

### Week 1: 项目搭建
1. 安装 Unity 2022.3 LTS 或更高版本
2. 创建 Unity 2D项目
3. 设置项目结构（场景、脚本、资源文件夹）
4. 配置2D渲染管线
5. 基础UI系统搭建

### Week 2-3: 玩家系统
1. 创建玩家控制器（移动、跳跃）
2. 创建主角视角相机
3. 设置玩家精灵（像素小人儿）
4. 实现玩家状态管理
5. 测试移动和跳跃功能

### Week 4-5: 世界基础
1. 创建基础地图（眠山村庄）
2. 创建玩家小屋（谷仓内）
3. 创建巨人NPC基础模型
4. 测试玩家在小屋内外的相机切换
5. 实现基础交互系统

### Week 6-7: NPC系统
1. 实现巨人NPC日程系统
2. 实现巨人NPC对话系统
3. 实现玩家与巨人互动检测
4. 实现礼物递送系统
5. 测试与巨人NPC的互动

### Week 8-9: 种田与烹饪
1. 实现基础种田系统
2. 实现烹饪系统基础
3. 实现食材系统
4. 实现菜谱系统
5. 测试烹饪流程

### Week 10-11: 建筑自由布置
1. 实现建筑编辑器UI
2. 实现布局编辑系统
3. 实现建筑保存/加载
4. 实现家具组件
5. 测试自由布置功能

### Week 12: 开店与经营
1. 实现开店系统
2. 实现顾客系统
3. 实现库存系统
4. 实现收入系统
5. 测试经营流程

---

**架构图与模块划分完成！** 🎮✨

**请告诉我：**
1. 图片在哪里？我可以查看你的店铺和家园内部设计图
2. 哪些模块需要修改？
3. 你想先开始哪个模块的开发？

老大，现在就开始制作吗？我帮你制定详细的技术方案！💪
